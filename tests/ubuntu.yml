# vi: set ft=yaml ts=2:
---

- name: create a ubuntu xenial container
  hosts: cihost
  roles:
    - role: mafalb.ansible_ci/node/docker
      container_name: xenial
      volumes:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      image_name: centos_image1
      src: ubuntu-16

- hosts: xenial
  gather_facts: false
  pre_tasks:
    - name: apt-get update
      changed_when: false
      raw: apt-get update
    - name: install python3
      changed_when: false
      raw: apt-get install -y python3-apt apt-transport-https

- hosts: xenial
  tasks:
    - name: assertions
      assert:
        that:
        - docker.assume_already_installed
        - ansible_facts.packages['docker-ce'] is defined
      when:
      - ansible_env.TRAVIS
    - name: get version of docker client
      check_mode: true
      package:
        name: docker-ce
        state: present
      register: _docker_package

    - name: check docker version
      assert:
        that:
          - not _docker_package.changed
    - name: debug variables
      assert:
        that:
          - ansible_distribution == 'CentOS'

    - name: create a file
      copy:
        content: bla
        dest: /tmp/bla

    - name: assert that the file does exist
      file:
        path: /tmp/bla
        state: file

- name: recreate a ubuntu xenial container
  hosts: cihost
  roles:
    - role: mafalb.ansible_ci/node/docker
      container_name: xenial
      volumes:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      image_name: centos_image1
      src: ubuntu-16
      recreate: true

- hosts: xenial
  gather_facts: false
  pre_tasks:
    - name: apt-get update
      changed_when: false
      raw: apt-get update
    - name: install python3
      changed_when: false
      raw: apt-get install -y python3-apt apt-transport-https

- hosts: xenial
  tasks:
    - name: assert that the file does exist
      file:
        path: /tmp/bla
        state: absent
