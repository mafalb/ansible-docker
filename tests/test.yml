# vi: set ft=yaml ts=2:
---

- hosts: localhost
  roles:
    - role: mafalb.docker/daemon
      docker_assume_already_installed: true
    - role: mafalb.docker/ansible
  tasks:
    - name: create image
      debug: msg="tbd"

    - name: get version of docker clientx
      check_mode: false
      command: docker version -f {% raw %} "{{ .Client.Version }}" {% endraw %}
      register: _docker_version

    - name: get version of docker daemon
      check_mode: false
      command: docker version -f {% raw %} "{{ .Server.Version }}" {% endraw %}
      register: _dockerd_version

    - debug: var=_docker_version
      tags:
        - never
        - debug

    - debug: var=_dockerd_version
      tags:
        - never
        - debug

    - name: assert that docker and dockerd versions match
      assert:
        that:
          - _docker_version.stdout == _dockerd_version.stdout

    - assert:
        that:
        - ansible_facts.packages['docker-ce'] is defined
      when:
      - ansible_env.TRAVIS
      - docker.assume_already_installed

    - assert:
        that:
        - ansible_facts.packages[docker.package] is defined
      when: not docker.assume_already_installed
