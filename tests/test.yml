# vi: set ft=yaml ts=2:
---

- hosts: cihost
  vars:
    - docker_assume_already_installed: true
  roles:
    - role: mafalb.docker/daemon
    - role: mafalb.docker/ansible
    - role: mafalb.docker/tests
  tasks:

    - name: check LICENSE file
      include_role:
        name: mafalb.docker/tests
        tasks_from: license

    - name: check README file
      include_role:
        name: mafalb.docker/tests
        tasks_from: readme

- name: create a ubuntu xenial container
  hosts: cihost
  roles:
    - role: mafalb.ansible_ci/node/docker
      container_name: xenial
      volumes:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      image_name: xenial_image
      src: ubuntu-16
      hostgroups:
        - testnodes
        - python3_hosts

- hosts: xenial
  gather_facts: true
  roles:
    - role: mafalb.docker/daemon
      docker_package: docker-ce

  tasks:
    - name: check docker-ce on ubuntu xenial
      include_role:
        name: mafalb.docker/tests
        tasks_from: xenial-docker-ce

    - name: assertions
      when:
        - ansible_env.CI is defined
        - ansible_env.CI == 'travis'
      assert:
        that:
        - docker.assume_already_installed
        - ansible_facts.packages['docker-ce'] is defined
